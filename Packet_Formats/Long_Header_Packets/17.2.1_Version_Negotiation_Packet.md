---
title: "17.2.1 版本协商数据包"
anchor: "17.2.1_Version_Negotiation_Packet"
weight: 1721
rank: "h2"
---

A Version Negotiation packet is inherently not version specific. Upon receipt by a client, it will be identified as a Version Negotiation packet based on the Version field having a value of 0.

版本协商数据包本质上不是版本特定的。客户端收到后，将根据版本字段值为0将其识别为版本协商数据包。

The Version Negotiation packet is a response to a client packet that contains a version that is not supported by the server. It is only sent by servers.

版本协商数据包是对一个包含了服务器不支持的版本的客户端数据包的响应。它只能被服务器发送。

The layout of a Version Negotiation packet is:

一个版本协商数据包的结构如下：

Version Negotiation Packet {
Header Form (1) = 1,
Unused (7),
Version (32) = 0,
Destination Connection ID Length (8),
Destination Connection ID (0..2040),
Source Connection ID Length (8),
Source Connection ID (0..2040),
Supported Version (32) ...,
}
Figure 14: Version Negotiation Packet

{{% block_ref
indx="Figure_14_Version_Negotiation_Packet"
title="图14：版本协商数据包" %}}

```
版本协商数据包 {
  包头形式 (1) = 1,
  未使用 (7),
  版本 (32) = 0,
  目标连接ID长度 (8),
  目标连接ID (0...2040),
  源连接ID长度 (8),
  源连接ID (0...2040),
  支持的版本 (32) ...,
}
```

{{% /block_ref %}}

The value in the Unused field is set to an arbitrary value by the server. Clients MUST ignore the value of this field. Where QUIC might be multiplexed with other protocols (see [RFC7983]), servers SHOULD set the most significant bit of this field (0x40) to 1 so that Version Negotiation packets appear to have the Fixed Bit field. Note that other versions of QUIC might not make a similar recommendation.

未使用字段中的值由服务器设置为任意值。客户端{{< req_level MUST >}}忽略此字段的值。当QUIC可能被与其他协议多路复用时（详见[RFC7983]()），服务器{{< req_level SHOULD >}}将这个字段的最高有效位（`0x40`）设置为1以使得版本协商数据包看起来具有固定比特位字段。要注意的是其他版本的QUIC不一定做出类似的推荐。

The Version field of a Version Negotiation packet MUST be set to 0x00000000.

版本协商数据包的版本字段{{< req_level MUST >}}被设置为`0x00000000`。

The server MUST include the value from the Source Connection ID field of the packet it receives in the Destination Connection ID field. The value for Source Connection ID MUST be copied from the Destination Connection ID of the received packet, which is initially randomly selected by a client. Echoing both connection IDs gives clients some assurance that the server received the packet and that the Version Negotiation packet was not generated by an entity that did not observe the Initial packet.

服务器在目标连接ID字段中使用的值{{< req_level MUST >}}来自接收到的那个数据包的源连接ID字段。源连接ID字段的值{{< req_level MUST >}}是从接收到的那个数据包的目标连接ID字段中拷贝来的，这是个来自客户端的随机选择的值。回显两个连接ID可以让客户端确信服务器收到了数据包，并且版本协商数据包不是由没有观察初始数据包的实体生成的。

Future versions of QUIC could have different requirements for the lengths of connection IDs. In particular, connection IDs might have a smaller minimum length or a greater maximum length. Version-specific rules for the connection ID therefore MUST NOT influence a decision about whether to send a Version Negotiation packet.

将来版本的QUIC可以对连接ID的长度有不同要求。特别是，连接ID可能具有更小的最小长度或更大的最大长度。

The remainder of the Version Negotiation packet is a list of 32-bit versions that the server supports.

版本协商数据包的剩余部分是一个列表，包含服务器支持的一个个32位长的版本号。

A Version Negotiation packet is not acknowledged. It is only sent in response to a packet that indicates an unsupported version; see Section 5.2.2.

版本协商包不会被确认。它只会作为一个使用了不受支持的版本的数据包的响应而被发送，详见[第5.2.5章]()。

The Version Negotiation packet does not include the Packet Number and Length fields present in other packets that use the long header form. Consequently, a Version Negotiation packet consumes an entire UDP datagram.

版本协商数据包不包含在其他使用了长包头形式的数据包中存在的数据包号和长度字段。因此，一个版本协商数据包消耗一整个UDP数据报。

A server MUST NOT send more than one Version Negotiation packet in response to a single UDP datagram.

服务器{{< req_level MUST_NOT >}}对单个UDP数据报响应超过1个版本协商数据包。

See Section 6 for a description of the version negotiation process.

有关版本协商的过程，详见[第6章]()。
